<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment Booking</title>
</head>
<body>
    <h1>Book Appointment</h1>
    <form id="appointmentForm">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required><br><br>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br><br>
        <label for="phone">Phone:</label>
        <input type="tel" id="phone" name="phone" required><br><br>
        <button type="submit">Book Appointment</button>
    </form>

    <h2>Appointments</h2>
    <ul id="appointmentList"></ul>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.7/axios.min.js"></script>
    <script>
        // Define CRUD operations using async/await functions
async function createAppointment(data) {
    const response = await fetch(' https://crudcrud.com/api/6d6baf5f8a634965a31c741c3ca46b5f/appointment', {
        method: 'POST',
       
    });
    return await response.json();
}

async function getAppointmentList() {
    const response = await fetch(' https://crudcrud.com/api/6d6baf5f8a634965a31c741c3ca46b5f/appointment ');
    return await response.json();
}

async function deleteAppointment(id) {
    const response = await fetch(` https://crudcrud.com/api/6d6baf5f8a634965a31c741c3ca46b5f/appointment/${id}`, {
        method: 'DELETE',
    });
    console.log("Delete Successfull")
    return response.ok;
}



document.getElementById('appointmentForm').addEventListener('submit', async (event) => {
    event.preventDefault();
    const formData = new FormData(event.target);
    const appointmentData = {
        username: formData.get('username'),
        email: formData.get('email'),
        phone: formData.get('phone'),
    };

    try {
        const newAppointment = await createAppointment(appointmentData);
        console.log('New appointment created:', newAppointment);

        // Reload appointment list after creating new appointment
        displayAppointments();
    } catch (error) {
        console.error('Error creating appointment:', error);
    }
});

// Function to display appointments
async function displayAppointments() {
    const appointmentList = document.getElementById('appointmentList');
    appointmentList.innerHTML = ''; // Clear previous list

    try {
        const appointments = await getAppointmentList();
        appointments.forEach((appointment) => {
            const listItem = document.createElement('li');
            listItem.textContent = `${appointment.username} - ${appointment.email} - ${appointment.phone}`;
            
            
            const editButton = document.createElement('button');
            editButton.textContent = 'Edit';
            editButton.addEventListener('click', () => editAppointment(appointment._id));

            
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.addEventListener('click', async () => {
                const deleted = await deleteAppointment(appointment._id);
                if (deleted) {
                    appointmentList.removeChild(listItem); // Remove item from UI
                }
            });

            listItem.appendChild(editButton);
            listItem.appendChild(deleteButton);
            appointmentList.appendChild(listItem);
        });
    } catch (error) {
        console.error('Error fetching appointments:', error);
    }
}

// Initial display of appointments
displayAppointments();

    </script>
</body>
</html>
